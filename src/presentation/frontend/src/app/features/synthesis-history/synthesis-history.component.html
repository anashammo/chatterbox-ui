<div class="history-container">
  <!-- Header -->
  <div class="header">
    <h1>Synthesis History</h1>
    <button class="btn btn-primary" routerLink="/">New Synthesis</button>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading && syntheses.length === 0">
    <div class="spinner"></div>
    <h3>Loading history...</h3>
  </div>

  <!-- Error State -->
  <div class="error-message" *ngIf="error">
    <span>{{ error }}</span>
    <button class="btn btn-primary" (click)="loadHistory()">Retry</button>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && syntheses.length === 0 && !error">
    <div class="empty-icon">ğŸ”Š</div>
    <h3>No syntheses yet</h3>
    <p>Click "New Synthesis" above to get started!</p>
  </div>

  <!-- Syntheses List -->
  <div class="syntheses-list" *ngIf="syntheses.length > 0">
    <div
      class="synthesis-card"
      *ngFor="let synthesis of syntheses"
    >
      <!-- Card Header -->
      <div class="card-header-row">
        <div class="card-info" (click)="viewSynthesis(synthesis)">
          <div class="synthesis-id">ID: {{ synthesis.id }}</div>
          <div class="card-badges">
            <span class="status-badge" [ngClass]="getStatusClass(synthesis.status)">
              {{ synthesis.status }}
            </span>
            <span class="model-badge" [ngClass]="'model-' + synthesis.model">
              {{ getModelIcon(synthesis.model) }} {{ synthesis.model }}
            </span>
          </div>
        </div>
        <div class="header-actions">
          <button
            class="btn-control"
            *ngIf="synthesis.status === 'completed'"
            (click)="playAudio(synthesis, $event)"
            [title]="currentlyPlayingId === synthesis.id ? 'Stop audio' : 'Play audio'"
          >
            {{ currentlyPlayingId === synthesis.id ? 'â¹ï¸' : 'â–¶ï¸' }}
          </button>
          <button
            class="btn-control"
            *ngIf="synthesis.status === 'completed'"
            (click)="downloadAudio(synthesis, $event)"
            title="Download audio file"
          >
            â¬‡ï¸
          </button>
          <button
            class="btn-control btn-control-delete"
            (click)="deleteSynthesis(synthesis, $event)"
            title="Delete synthesis"
          >
            ğŸ—‘ï¸
          </button>
        </div>
      </div>

      <!-- Text Preview -->
      <div class="text-preview-container" (click)="viewSynthesis(synthesis)">
        <div class="text-label">Text:</div>
        <div class="text-content" [class.rtl]="isArabic(synthesis.input_text)">
          {{ synthesis.input_text }}
        </div>
      </div>

      <!-- Metadata -->
      <div class="card-metadata" (click)="viewSynthesis(synthesis)">
        <span class="meta-item" *ngIf="synthesis.output_duration_seconds">
          â±ï¸ {{ formatDuration(synthesis.output_duration_seconds) }}
        </span>
        <span class="meta-item" *ngIf="synthesis.processing_time_seconds">
          âš¡ {{ synthesis.processing_time_seconds | number:'1.2-2' }}s
        </span>
        <span class="meta-item" *ngIf="synthesis.language">
          ğŸŒ {{ synthesis.language | uppercase }}
        </span>
        <span class="meta-item" *ngIf="synthesis.voice_reference">
          ğŸ¤ {{ synthesis.voice_reference.name }}
          <span *ngIf="synthesis.voice_reference.language">({{ synthesis.voice_reference.language }})</span>
        </span>
        <span class="meta-item">
          ğŸ“… {{ formatDate(synthesis.created_at) }}
        </span>
      </div>

      <!-- Error Display -->
      <div class="card-error" *ngIf="synthesis.status === 'failed' && synthesis.error_message">
        {{ synthesis.error_message }}
      </div>

      <!-- View Link -->
      <div class="card-footer" (click)="viewSynthesis(synthesis)">
        <span class="view-link">View Details â†’</span>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button
      class="btn btn-secondary"
      (click)="firstPage()"
      [disabled]="!canGoPrevious || isLoading"
    >
      First
    </button>
    <button
      class="btn btn-secondary"
      (click)="previousPage()"
      [disabled]="!canGoPrevious || isLoading"
    >
      Previous
    </button>
    <span class="page-info">
      Page {{ currentPage }} of {{ totalPages }}
    </span>
    <button
      class="btn btn-secondary"
      (click)="nextPage()"
      [disabled]="!canGoNext || isLoading"
    >
      Next
    </button>
    <button
      class="btn btn-secondary"
      (click)="lastPage()"
      [disabled]="!canGoNext || isLoading"
    >
      Last
    </button>
  </div>

  <!-- Results Info -->
  <div class="results-info" *ngIf="syntheses.length > 0">
    Showing {{ syntheses.length }} of {{ totalItems }} synthesis(es)
  </div>
</div>
