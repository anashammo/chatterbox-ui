<div class="voices-container">
  <div class="header">
    <h1>Voice References</h1>
    <a routerLink="/" class="btn btn-secondary">‚Üê Back to Synthesize</a>
  </div>

  <!-- Messages -->
  <div class="success-message" *ngIf="successMessage">
    {{ successMessage }}
    <button class="close-btn" (click)="successMessage = null">&times;</button>
  </div>

  <div class="error-message" *ngIf="error">
    {{ error }}
    <button class="close-btn" (click)="error = null">&times;</button>
  </div>

  <!-- Upload Form -->
  <div class="upload-card">
    <h2>Upload Voice Reference</h2>
    <p class="help-text">
      Upload a 5-30 second audio clip (~10s recommended) for voice cloning.
      Supported formats: WAV, MP3, FLAC, OGG. Max size: 10MB.
    </p>

    <div class="upload-form">
      <div class="form-group">
        <label for="voiceName">Voice Name</label>
        <input
          type="text"
          id="voiceName"
          [(ngModel)]="voiceName"
          placeholder="Enter a name for this voice"
          [disabled]="isUploading"
        />
      </div>

      <div class="form-group">
        <label for="fileInput">Audio File</label>
        <input
          type="file"
          id="fileInput"
          accept=".wav,.mp3,.flac,.ogg,audio/*"
          (change)="onFileSelected($event)"
          [disabled]="isUploading"
        />
        <p class="file-info" *ngIf="selectedFile">
          Selected: {{ selectedFile.name }} ({{ (selectedFile.size / 1024 / 1024) | number:'1.2-2' }} MB)
        </p>
      </div>

      <button
        class="btn btn-primary"
        (click)="uploadVoiceReference()"
        [disabled]="!selectedFile || !voiceName.trim() || isUploading"
      >
        <span *ngIf="isUploading" class="spinner"></span>
        {{ isUploading ? 'Uploading...' : 'Upload Voice Reference' }}
      </button>
    </div>
  </div>

  <!-- Voice References List -->
  <div class="voices-section">
    <h2>Your Voice References</h2>

    <div class="loading" *ngIf="isLoading">
      <div class="spinner-large"></div>
    </div>

    <div class="empty-state" *ngIf="!isLoading && voiceReferences.length === 0">
      <p>No voice references yet. Upload one to get started with voice cloning.</p>
    </div>

    <div class="voices-list" *ngIf="!isLoading && voiceReferences.length > 0">
      <div class="voice-card" *ngFor="let ref of voiceReferences">
        <div class="voice-info">
          <h3>{{ ref.name }}</h3>
          <div class="voice-meta">
            <span>{{ ref.duration_seconds | number:'1.1-1' }}s</span>
            <span>{{ ref.file_size_mb | number:'1.2-2' }} MB</span>
            <span>{{ formatDate(ref.created_at) }}</span>
          </div>
          <p class="filename">{{ ref.original_filename }}</p>
        </div>

        <div class="voice-actions">
          <button
            class="btn-icon"
            (click)="playAudio(ref)"
            [title]="currentlyPlayingId === ref.id ? 'Stop' : 'Play'"
          >
            {{ currentlyPlayingId === ref.id ? '‚èπÔ∏è' : '‚ñ∂Ô∏è' }}
          </button>
          <button
            class="btn-icon btn-delete"
            (click)="deleteVoiceReference(ref)"
            title="Delete"
          >
            üóëÔ∏è
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
