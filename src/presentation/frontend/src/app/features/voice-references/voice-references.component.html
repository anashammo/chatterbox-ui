<div class="voices-container">
  <!-- Header -->
  <div class="header">
    <h1>Voice References</h1>
    <div class="header-actions">
      <button class="btn btn-primary" routerLink="/">New Synthesis</button>
      <button class="btn btn-secondary" routerLink="/history">View History</button>
    </div>
  </div>

  <!-- Messages -->
  <div class="success-message" *ngIf="successMessage">
    <span>{{ successMessage }}</span>
    <button class="close-btn" (click)="successMessage = null">&times;</button>
  </div>

  <div class="error-message" *ngIf="error">
    <span>{{ error }}</span>
    <button class="close-btn" (click)="error = null">&times;</button>
  </div>

  <!-- Upload Form -->
  <div class="upload-card">
    <h2>Upload Voice Reference</h2>
    <p class="help-text">
      Upload a 5-30 second audio clip (~10s recommended) for voice cloning.
      Supported formats: WAV, MP3, FLAC, OGG. Max size: 10MB.
    </p>

    <div class="upload-form">
      <div class="form-group">
        <label for="voiceName">Voice Name</label>
        <input
          type="text"
          id="voiceName"
          [(ngModel)]="voiceName"
          placeholder="Enter a name for this voice"
          [disabled]="isUploading"
        />
      </div>

      <div class="form-group">
        <label for="voiceLanguage">Language</label>
        <select
          id="voiceLanguage"
          [(ngModel)]="selectedLanguage"
          [disabled]="isUploading"
          class="language-select"
        >
          <option *ngFor="let lang of availableLanguages" [value]="lang.code">
            {{ lang.name }}{{ lang.code ? ' (' + lang.code + ')' : '' }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="fileInput">Audio File</label>
        <input
          type="file"
          id="fileInput"
          accept=".wav,.mp3,.flac,.ogg,audio/*"
          (change)="onFileSelected($event)"
          [disabled]="isUploading"
          [class.hidden]="selectedFile"
        />

        <!-- File Preview Card (shown when file selected) -->
        <div class="file-preview-card" *ngIf="selectedFile">
          <div class="file-icon">üéµ</div>
          <div class="file-details">
            <div class="file-name">{{ selectedFile.name }}</div>
            <div class="file-meta">
              Size: {{ (selectedFile.size / 1024) | number:'1.2-2' }} KB
            </div>
            <div class="file-meta">
              Type: {{ selectedFile.type || 'audio/*' }}
            </div>
          </div>
          <div class="file-actions">
            <button
              type="button"
              class="btn-circle btn-play"
              (click)="togglePreviewAudio()"
              [title]="isPreviewPlaying ? 'Stop' : 'Play'"
            >
              {{ isPreviewPlaying ? '‚èπ' : '‚ñ∂' }}
            </button>
            <button
              type="button"
              class="btn-circle btn-remove"
              (click)="removeSelectedFile()"
              title="Remove file"
            >
              ‚úï
            </button>
          </div>
        </div>
      </div>

      <button
        class="btn btn-primary btn-upload"
        (click)="uploadVoiceReference()"
        [disabled]="!selectedFile || !voiceName.trim() || isUploading"
      >
        <span *ngIf="isUploading" class="spinner-small"></span>
        {{ isUploading ? 'Uploading...' : 'Upload Voice Reference' }}
      </button>
    </div>
  </div>

  <!-- Voice References List -->
  <div class="voices-section">
    <h2>Your Voice References</h2>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner"></div>
      <h3>Loading voice references...</h3>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && voiceReferences.length === 0">
      <div class="empty-icon">üé§</div>
      <h3>No voice references yet</h3>
      <p>Upload a voice reference above to get started with voice cloning.</p>
    </div>

    <!-- Voices List -->
    <div class="voices-list" *ngIf="!isLoading && voiceReferences.length > 0">
      <div class="voice-card" *ngFor="let ref of voiceReferences">
        <!-- Card Header -->
        <div class="card-header-row">
          <div class="card-info">
            <div class="voice-id">ID: {{ ref.id }}</div>
            <div class="card-badges">
              <span class="voice-name-badge">üé§ {{ ref.name }}</span>
              <span class="language-badge" *ngIf="ref.language">üåê {{ ref.language }}</span>
            </div>
          </div>
          <div class="header-actions">
            <button
              class="btn-control"
              (click)="playAudio(ref)"
              [title]="currentlyPlayingId === ref.id ? 'Stop audio' : 'Play audio'"
            >
              {{ currentlyPlayingId === ref.id ? '‚èπÔ∏è' : '‚ñ∂Ô∏è' }}
            </button>
            <button
              class="btn-control btn-control-delete"
              (click)="deleteVoiceReference(ref)"
              title="Delete voice reference"
            >
              üóëÔ∏è
            </button>
          </div>
        </div>

        <!-- File Info Preview -->
        <div class="file-preview-container">
          <div class="text-label">File:</div>
          <div class="text-content">{{ ref.original_filename }}</div>
        </div>

        <!-- Metadata -->
        <div class="card-metadata">
          <span class="meta-item">
            ‚è±Ô∏è {{ ref.duration_seconds | number:'1.1-1' }}s
          </span>
          <span class="meta-item">
            üìÅ {{ ref.file_size_mb | number:'1.2-2' }} MB
          </span>
          <span class="meta-item">
            üìÖ {{ formatDate(ref.created_at) }}
          </span>
        </div>
      </div>
    </div>

    <!-- Results Info -->
    <div class="results-info" *ngIf="voiceReferences.length > 0">
      Showing {{ voiceReferences.length }} voice reference(s)
    </div>
  </div>
</div>
