# ============================================================================
# Chatterbox TTS API - Environment Configuration
# ============================================================================
# Location: src/presentation/api/.env
#
# SETUP INSTRUCTIONS:
# 1. Copy this file to .env in the same directory:
#    cp src/presentation/api/.env.example src/presentation/api/.env
#
# 2. For Docker deployment, ALSO copy to project root for docker-compose:
#    cp src/presentation/api/.env .env
#    (Or export POSTGRES_*, NGROK_AUTHTOKEN, *_PORT vars in your shell)
#
# 3. Edit .env and configure your settings (especially HF_TOKEN, NGROK_AUTHTOKEN)
#
# ============================================================================

# ============================================================================
# DEPLOYMENT MODE
# ============================================================================
# Choose ONE deployment mode by uncommenting the appropriate DATABASE_URL
# and file storage paths below.

# --- LOCAL DEVELOPMENT (SQLite) ---
# Use these settings when running without Docker
DATABASE_URL=sqlite:///./chatterbox_tts.db
AUDIO_OUTPUT_DIR=./audio_outputs
VOICE_REFERENCE_DIR=./voice_references

# --- DOCKER DEPLOYMENT (PostgreSQL) ---
# Uncomment these and comment out the LOCAL settings above for Docker
# DATABASE_URL=postgresql://chatterbox:change_this_secure_password@postgres:5432/chatterbox_tts?client_encoding=utf8
# AUDIO_OUTPUT_DIR=/app/audio_outputs
# VOICE_REFERENCE_DIR=/app/voice_references

# ============================================================================
# PostgreSQL Configuration (Docker only)
# ============================================================================
# These are used by docker-compose.yml for the PostgreSQL container
# Change POSTGRES_PASSWORD for production!
POSTGRES_USER=chatterbox
POSTGRES_PASSWORD=change_this_secure_password_in_production
POSTGRES_DB=chatterbox_tts
POSTGRES_PORT=5433

# ============================================================================
# Application Settings
# ============================================================================
APP_NAME="Chatterbox TTS API"
APP_VERSION=1.0.0

# Debug mode (detailed error messages)
# WARNING: Set to false in production
DEBUG=false

# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# ============================================================================
# API Server Configuration
# ============================================================================
# Host to bind the API server to
# - 0.0.0.0: Listen on all interfaces (required for Docker)
# - 127.0.0.1: Listen only on localhost
API_HOST=0.0.0.0

# Port for the API server
API_PORT=8002

# External port mappings (used by docker-compose.yml)
BACKEND_PORT=8002
FRONTEND_PORT=4201

# ============================================================================
# HuggingFace Authentication (REQUIRED)
# ============================================================================
# Get your token from: https://huggingface.co/settings/tokens
# Required for downloading Chatterbox models from HuggingFace Hub
# Note: You must accept the model license on HuggingFace first
HF_TOKEN=

# ============================================================================
# Chatterbox TTS Model Configuration
# ============================================================================
# Default TTS model for synthesis
# Options:
#   - multilingual: 500M params, 23+ languages, zero-shot voice cloning (recommended)
#   - turbo:        350M params, fastest, single-step generation
#   - standard:     500M params, best quality, CFG/exaggeration tuning
TTS_DEFAULT_MODEL=multilingual

# Device for TTS inference
# - cuda: GPU acceleration (requires NVIDIA GPU with CUDA 12.8+)
# - cpu:  CPU only (slower, but works without GPU)
TTS_DEVICE=cuda

# Default CFG weight for accent/style transfer (0.0-1.0)
TTS_DEFAULT_CFG_WEIGHT=0.5

# Default exaggeration/expressiveness (0.0-1.0+)
TTS_DEFAULT_EXAGGERATION=0.5

# Maximum text length for synthesis (in characters)
TTS_MAX_TEXT_LENGTH=5000

# ============================================================================
# Performance Configuration
# ============================================================================
# Enable torch.compile() for JIT optimization (10-30% speedup after warmup)
# Requires PyTorch 2.0+, may increase model load time
ENABLE_TORCH_COMPILE=false

# Enable voice reference tensor caching (reduces disk I/O)
ENABLE_VOICE_CACHING=true

# Maximum number of voice references to cache in memory
VOICE_CACHE_MAX_SIZE=10

# Trim leading/trailing silence from synthesized audio
AUDIO_TRIM_SILENCE=true

# Enable chunking of long text for better quality on long inputs
ENABLE_TEXT_CHUNKING=true

# Maximum characters per chunk when text chunking is enabled
TTS_CHUNK_MAX_CHARS=250

# Enable detailed performance timing logs
ENABLE_PERFORMANCE_LOGGING=true

# Clear GPU cache after each synthesis (may impact performance but saves memory)
ENABLE_GPU_MEMORY_CLEANUP=false

# Enable SDPA attention (EXPERIMENTAL - requires Chatterbox PR #398 to be merged)
# See: https://github.com/resemble-ai/chatterbox/issues/339
ENABLE_SDPA_ATTENTION=false

# ============================================================================
# Model Pre-download Configuration (Docker only)
# ============================================================================
# Enable model pre-download on container startup
# Set to false to download models on first use instead
PRELOAD_MODELS=true

# Comma-separated list of models to pre-download (ordered by priority)
# Options: multilingual, turbo, standard
PRELOAD_MODEL_LIST=multilingual,turbo,standard

# Run JIT warmup synthesis on startup (prevents first-request delay)
# Runs a dummy synthesis to trigger torch.compile() JIT compilation
WARMUP_ON_STARTUP=true

# ============================================================================
# File Storage Settings
# ============================================================================
# Maximum voice reference file size (in MB)
MAX_VOICE_REFERENCE_SIZE_MB=10

# Voice reference duration limits (in seconds)
# Chatterbox recommends ~10 seconds for optimal voice cloning
MIN_VOICE_REFERENCE_DURATION_SECONDS=5
MAX_VOICE_REFERENCE_DURATION_SECONDS=30

# ============================================================================
# CORS (Cross-Origin Resource Sharing) Configuration
# ============================================================================
# Allowed origins for CORS (JSON array format)
#
# Local development:
CORS_ORIGINS=["http://localhost:4201","http://localhost:4200","http://localhost:3000"]
#
# Docker (includes container networking):
# CORS_ORIGINS=["http://localhost","http://localhost:4201","http://frontend","*"]
#
# Production (replace with your domain):
# CORS_ORIGINS=["https://yourdomain.com"]

# ============================================================================
# Ngrok Configuration (Required by default for Docker)
# ============================================================================
# Get your auth token from: https://dashboard.ngrok.com/get-started/your-authtoken
#
# NOTE: Ngrok is ENABLED by default in Docker scripts.
# - To start WITHOUT ngrok: python scripts/docker/run.py --no-ngrok
# - To rebuild WITHOUT ngrok: python scripts/docker/rebuild.py --no-ngrok
#
# If NGROK_AUTHTOKEN is not set, you must use --no-ngrok flag.
NGROK_AUTHTOKEN=

# ============================================================================
# Hot-Reload Configuration (Docker only)
# ============================================================================
# Enable hot-reload for development (auto-restart on code changes)
# Set to false for production deployments
HOT_RELOAD=true

# ============================================================================
# NOTES
# ============================================================================
#
# 1. After changing .env, restart the server for changes to take effect
#    - Local: Restart uvicorn
#    - Docker: docker compose restart backend
#
# 2. GPU Requirements:
#    - NVIDIA GPU with CUDA 12.8+ (RTX 5090 requires CUDA 12.8+)
#    - For Docker: nvidia-docker runtime must be installed
#    - Verify GPU: python -c "import torch; print(torch.cuda.is_available())"
#
# 3. Model Downloads:
#    - Models are cached in ~/.cache/huggingface/ (local) or Docker volume
#    - First use of a model will download it automatically
#    - Model sizes: turbo ~350MB, standard/multilingual ~500MB
#
# 4. Database:
#    - Local: SQLite file at ./chatterbox_tts.db
#    - Docker: PostgreSQL container (data in chatterbox-postgres-data volume)
#    - Initialize: python scripts/setup/init_db.py
#
# 5. Frontend:
#    - Expects backend on port 8002
#    - If you change API_PORT, update frontend environment.ts
#    - Path: src/presentation/frontend/src/environments/environment.ts
#
# 6. Docker Volumes:
#    - chatterbox-postgres-data: Database files
#    - chatterbox-audio-outputs: Synthesized audio files
#    - chatterbox-voice-references: Voice reference files
#    - chatterbox-model-cache: HuggingFace model cache
#
# ============================================================================
